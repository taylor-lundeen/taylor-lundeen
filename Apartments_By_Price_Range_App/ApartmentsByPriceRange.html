<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
    <title>Apartments by rent price range</title>
    <link rel="stylesheet" href="https://js.arcgis.com/3.23/dijit/themes/claro/claro.css">
    <link rel="stylesheet" href="https://js.arcgis.com/3.23/esri/css/esri.css">
    <style>
      html, body, #viewDiv {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      #search {
        display: block;
        position: absolute;
        z-index: 3;
        top: 20px;
        left: 75px;
      }
      #sidebar1 {
        position: absolute;
        max-width: 250px;
        right: 10px;
        top: 10px;
        padding: 1em 1em 0 1em;
        background: #fff;
        box-shadow: -4px 4px 4px 0px #959595;      
        text-align: center;
        border: solid 2px #000;
        border-radius: 0 0 0 0px;            
      }
      #sidebar2 {
        position: absolute;
        max-width: 250px;
        right: 10px;
        top: 385px;
        padding: 1em 1em 0 1em;
        background: #fff;
        box-shadow: -4px 4px 4px 0px #959595;
        text-align: center;
        border: solid 2px #000;
        border-radius: 0 0 0 0px;
        visibility: hidden;
      }
      #legendDiv {
      	font: 14px verdana;
      }
      #popupDiv {
      	font: 14px arial;
      }
      br {
      	line-height: 5px;
      }      
    </style>
    <script src="https://js.arcgis.com/3.23/"></script>
    <script>
      var map;

      require([
        "esri/map",
        "esri/graphic",
        "esri/layers/FeatureLayer",
        "esri/renderers/DotDensityRenderer",
        "esri/renderers/ScaleDependentRenderer",
        "esri/symbols/SimpleFillSymbol",
        "esri/symbols/SimpleLineSymbol",
        "esri/symbols/SimpleMarkerSymbol",
        "esri/dijit/Geocoder",
        "esri/dijit/Legend",
        "esri/dijit/Scalebar",
        "esri/dijit/Popup",
        "esri/dijit/PopupTemplate",
        "dijit/layout/ContentPane",
        "dijit/registry",
        "dojo/dom",
        "dojo/ready",
        "dojo/parser",
        "dojo/on",       
        "dojo/dom-construct",
        "dojo/_base/Color",
        "dojo/_base/connect",
        "dojo/domReady!"
        ], 
        function(
          Map, Graphic, FeatureLayer, DotDensityRenderer, ScaleDependentRenderer, SimpleFillSymbol, SimpleLineSymbol, SimpleMarkerSymbol, Geocoder, Legend, Scalebar, Popup, PopupTemplate, ContentPane, registry, dom, ready, parser, on, domConstruct, Color, connect
        ) {
          var popupOptions = {
            fillSymbol: new SimpleFillSymbol(SimpleFillSymbol.STYLE_SOLID,
              new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, new Color([255, 255, 0]), 3),
              new Color([255, 255, 0, 0.2])           
            )           
          };

          var popup = new Popup(popupOptions, domConstruct.create("div"));

          //Setup the popup templates for 0 bedroom apartments

          var CountyPopupTemplate0 = new PopupTemplate({
            title: "Number of 0BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST4",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_0BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_0BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST9",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST4", "B25068_0BDR_200TO499", "B25068_0BDR_500TO999", "B25068EST9"
              		]
              	}
              }
            ]
          });

          var PlacePopupTemplate0 = new PopupTemplate({
            title: "Number of 0BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST4",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_0BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_0BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST9",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST4", "B25068_0BDR_200TO499", "B25068_0BDR_500TO999", "B25068EST9"
              		]
              	}
              }
            ]
          });

          var TractPopupTemplate0 = new PopupTemplate({
            title: "{NAME}: Number of 0BR apartments",
            fieldInfos: [
            {
              fieldName: "B25068EST4",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_0BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_0BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST9",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST4", "B25068_0BDR_200TO499", "B25068_0BDR_500TO999", "B25068EST9"
              		]
              	}
              }
            ]
          });

          // Setup the popup templtes for 1 bedroom apartments

          var CountyPopupTemplate1 = new PopupTemplate({
            title: "Number of 1BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST13",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_1BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_1BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST18",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST13", "B25068_1BDR_200TO499", "B25068_1BDR_500TO999", "B25068EST18"
              		]
              	}
              }
            ]
          });

          var PlacePopupTemplate1 = new PopupTemplate({
            title: "Number of 1BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST13",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_1BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_1BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST18",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST13", "B25068_1BDR_200TO499", "B25068_1BDR_500TO999", "B25068EST18"
              		]
              	}
              }
            ]
          });
         
          var TractPopupTemplate1 = new PopupTemplate({
            title: "{NAME}: Number of 1BR apartments",
            fieldInfos: [
            {
              fieldName: "B25068EST13",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_1BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_1BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST18",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST13", "B25068_1BDR_200TO499", "B25068_1BDR_500TO999", "B25068EST18"
              		]
              	}
              }
            ]
          });

          // Setup the popup templates for 2 bedroom apartments 

          var CountyPopupTemplate2 = new PopupTemplate({
            title: "Number of 2BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST22",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_2BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_2BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST27",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST22", "B25068_2BDR_200TO499", "B25068_2BDR_500TO999", "B25068EST27"
              		]
              	}
              }
            ]
          });

          var PlacePopupTemplate2 = new PopupTemplate({
            title: "Number of 2BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST22",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_2BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_2BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST27",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST22", "B25068_2BDR_200TO499", "B25068_2BDR_500TO999", "B25068EST27"
              		]
              	}
              }
            ]
          });

          var TractPopupTemplate2 = new PopupTemplate({
            title: "{NAME}: Number of 2BR apartments",
            fieldInfos: [
            {
              fieldName: "B25068EST22",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_2BDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_2BDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST27",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST22", "B25068_2BDR_200TO499", "B25068_2BDR_500TO999", "B25068EST27"
              		]
              	}
              }
            ]
          });

          // Setup the popup templates for 3 bedroom apartments

          var CountyPopupTemplate3 = new PopupTemplate({
            title: "Number of 3BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST31",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_3PLUSBDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_3PLUSBDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST36",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST31", "B25068_3BDR_200TO499", "B25068_3BDR_500TO999", "B25068EST36"
              		]
              	}
              }
            ]
          });

          var PlacePopupTemplate3 = new PopupTemplate({
            title: "Number of 3BR apartments: {NAME}",
            fieldInfos: [
            {
              fieldName: "B25068EST31",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_3PLUSBDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_3PLUSBDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST36",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST31", "B25068_3BDR_200TO499", "B25068_3BDR_500TO999", "B25068EST36"
              		]
              	}
              }
            ]
          });

          var TractPopupTemplate3 = new PopupTemplate({
            title: "{NAME}: Number of 3BR apartments",
            fieldInfos: [
            {
              fieldName: "B25068EST31",
              visible: true,
              label: "-$200"
            }, {
              fieldName: "B25068_3PLUSBDR_200TO499",
              visible: true,
              label: "$200-499"
            }, {
              fieldName: "B25068_3PLUSBDR_500TO999",
              visible: true,
              label: "$500-999"
            }, {
              fieldName: "B25068EST36",
              visible: true,
              label: "$1,000+"
            }
            ],
            mediaInfos: [
              {
              	type: "columnchart",
              	value: {
              		fields: [
              		  "B25068EST31", "B25068_3BDR_200TO499", "B25068_3BDR_500TO999", "B25068EST36"
              		]
              	}
              }
            ]
          });

          // Setup the map layers at the County, City(Place), and Census Tract Levels

          var CountyLayer = new FeatureLayer("https://services.arcgis.com/VTyQ9soqVukalItT/ArcGIS/rest/services/ACS_5YR_Housing_Estimate_Data_by_County/FeatureServer/0",
              {
                mode: FeatureLayer.MODE_ONDEMAND,
                infoTemplate: CountyPopupTemplate1,
                outFields: ["NAME", "B25068EST4", "B25068_0BDR_200TO499", "B25068_0BDR_500TO999", "B25068EST9", "B25068EST13", "B25068_1BDR_200TO499", "B25068_1BDR_500TO999", "B25068EST18", "B25068EST22", "B25068_2BDR_200TO499", "B25068_2BDR_500TO999", "B25068EST27", "B25068EST31", "B25068_3PLUSBDR_200TO499", "B25068_3PLUSBDR_500TO999", "B25068EST36"]
            });

          var PlaceLayer = new FeatureLayer("https://services.arcgis.com/VTyQ9soqVukalItT/ArcGIS/rest/services/ACS_5YR_Housing_Estimate_Data_by_Place/FeatureServer/0",
              {
                mode: FeatureLayer.MODE_ONDEMAND,
                infoTemplate: PlacePopupTemplate1,
                outFields: ["NAME", "B25068EST4", "B25068_0BDR_200TO499", "B25068_0BDR_500TO999", "B25068EST9", "B25068EST13", "B25068_1BDR_200TO499", "B25068_1BDR_500TO999", "B25068EST18", "B25068EST22", "B25068_2BDR_200TO499", "B25068_2BDR_500TO999", "B25068EST27", "B25068EST31", "B25068_3PLUSBDR_200TO499", "B25068_3PLUSBDR_500TO999", "B25068EST36"]
            });

          var TractLayer = new FeatureLayer("https://services.arcgis.com/VTyQ9soqVukalItT/ArcGIS/rest/services/ACS_5YR_Housing_Estimate_Data_by_Tract/FeatureServer/0",
              {
                mode: FeatureLayer.MODE_ONDEMAND,
                infoTemplate: TractPopupTemplate1,
                outFields: ["NAME", "B25068EST4", "B25068_0BDR_200TO499", "B25068_0BDR_500TO999", "B25068EST9", "B25068EST13", "B25068_1BDR_200TO499", "B25068_1BDR_500TO999", "B25068EST18", "B25068EST22", "B25068_2BDR_200TO499", "B25068_2BDR_500TO999", "B25068EST27", "B25068EST31", "B25068_3PLUSBDR_200TO499", "B25068_3PLUSBDR_500TO999", "B25068EST36"]
            });

          // Setup the dot density renderers so are layer data is dislayed as dot density
          
          var Dots01 = DotDensityRenderer ({
            fields: [{            
              name: "B25068EST4",
              color: new Color ([255, 145, 145]) 
            }, {
              name: "B25068_0BDR_200TO499",
              color: new Color ([255, 77, 77]) 
            }, {
              name: "B25068_0BDR_500TO999",
              color:  new Color ([179, 0, 0])
            }, {
              name: "B25068EST9",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 200,
            dotSize: 6
          });

          var Dots02 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST4",
              color: new Color ([255, 145, 145]) 
            }, {
              name: "B25068_0BDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_0BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST9",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 800,
            dotSize: 6
          });

          var Dots03 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST4",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_0BDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_0BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST9",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 50,
            dotSize: 6
          });

          var Dots04 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST4",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_0BDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_0BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST9",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 10,
            dotSize: 6
          });

          var Dots05 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST4",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_0BDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_0BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST9",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 5,
            dotSize: 6
          });
              
          var Dots11 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST13",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_1BDR_200TO499",
              color: new Color ([255, 77, 77]) 
            }, {
                name: "B25068_1BDR_500TO999",
                color: new Color ([179, 0, 0])
            }, { 
                name: "B25068EST18",
                color: new Color ([77, 0, 0])
            }],   
            dotShape: "circle",
            dotValue: 200,
            dotSize: 6
          });

          var Dots12 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST13",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_1BDR_200TO499",
              color: new Color ([255, 77, 77]) 
            }, {
                name: "B25068_1BDR_500TO999",
                color: new Color ([179, 0, 0])
            }, { 
                name: "B25068EST18",
                color: new Color ([77, 0, 0])
            }],   
            dotShape: "circle",
            dotValue: 800,
            dotSize: 6
          });

          var Dots13 = DotDensityRenderer ({
            fields: [{
                name: "B25068EST13",
                color: new Color ([255, 145, 145])
            }, {
              name: "B25068_1BDR_200TO499",
              color: new Color ([255, 77, 77]) 
            }, {
              name: "B25068_1BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST18",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 50,
            dotSize: 6  
          });

          var Dots14 = DotDensityRenderer ({
            fields: [{
                name: "B25068EST13",
                color: new Color ([255, 145, 145])
            }, {
              name: "B25068_1BDR_200TO499",
              color: new Color ([255, 77, 77]) 
            }, {
              name: "B25068_1BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST18",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 10,
            dotSize: 6  
          });

          var Dots15 = DotDensityRenderer ({
            fields: [{
                name: "B25068EST13",
                color: new Color ([255, 145, 145])
            }, {
              name: "B25068_1BDR_200TO499",
              color: new Color ([255, 77, 77]) 
            }, {
              name: "B25068_1BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST18",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 5,
            dotSize: 6  
          });

          var Dots21 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST22",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_2BDR_200TO499",
              color: new Color ([255, 77, 77]) 
            }, {
              name: "B25068_2BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST27",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 200,
            dotSize: 6
          });

          var Dots22 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST22",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_2BDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_2BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST27",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 800,
            dotSize: 6
          });

          var Dots23 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST22",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_2BDR_200TO499",
              color: new Color ([255, 77, 77])            
            }, {
              name: "B25068_2BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST27",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 50,
            dotSize: 6
          });

          var Dots24 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST22",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_2BDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_2BDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST27",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 10,
            dotSize: 6
          });

          var Dots25 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST22",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_2BDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_2BDR_500TO999", 
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST27",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 5,
            dotSize: 6
          });

          var Dots31 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST31",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_3PLUSBDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_3PLUSBDR_500TO999",
               color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST36",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 200,
            dotSize: 6
          });

          var Dots32 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST31",
              color: new Color ([255, 145, 145])
          }, {
              name: "B25068_3PLUSBDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_3PLUSBDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST36",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 800,
            dotSize: 6
          });

          var Dots33 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST31",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_3PLUSBDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_3PLUSBDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST36",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 50,
            dotSize: 6
          });

          var Dots34 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST31",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_3PLUSBDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_3PLUSBDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST36",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 10,
            dotSize: 6
          });

          var Dots35 = DotDensityRenderer ({
            fields: [{
              name: "B25068EST31",
              color: new Color ([255, 145, 145])
            }, {
              name: "B25068_3PLUSBDR_200TO499",
              color: new Color ([255, 77, 77])
            }, {
              name: "B25068_3PLUSBDR_500TO999",
              color: new Color ([179, 0, 0])
            }, {
              name: "B25068EST36",
              color: new Color ([77, 0, 0])
            }],
            dotShape: "circle",
            dotValue: 5,
            dotSize: 6
          });

          // Setup the map zoom ranges to display the data at the County, City and Tract level

          var CountyRanges0 = {rendererInfos: [{ 
            "renderer": Dots01,
            "minZoom": 6,
            "maxZoom": 8
          }, {
            "renderer": Dots02,
            "minZoom": 2,  
            "maxZoom": 5 
          }]};

          var PlaceRanges0 = {rendererInfos: [{
            "renderer": Dots03,
            "minZoom": 9,
            "maxZoom": 10  
          }]};  

          var TractRanges0 = {rendererInfos: [{
            "renderer": Dots04,
            "minZoom": 11,
            "maxZoom": 12  
          }, {
            "renderer": Dots05,
            "minZoom": 13,
            "maxZoom": 19
          }]};       

          var CountyRanges1 = {rendererInfos: [{ 
            "renderer": Dots11,
            "minZoom": 6,
            "maxZoom": 8
          }, {
            "renderer": Dots12,
            "minZoom": 2,  
            "maxZoom": 5 
          }]};
          
          var PlaceRanges1 = {rendererInfos: [{
            "renderer": Dots13,
            "minZoom": 9,
            "maxZoom": 10  
          }]};

          var TractRanges1 = {rendererInfos: [{
            "renderer": Dots14,
            "minZoom": 11,
            "maxZoom": 12  
          }, {
            "renderer": Dots15,
            "minZoom": 13,
            "maxZoom": 19
          }]}; 

          var CountyRanges2 = {rendererInfos: [{ 
            "renderer": Dots21,
            "minZoom": 6,
            "maxZoom": 8
          }, {
            "renderer": Dots22,
            "minZoom": 2,  
            "maxZoom": 5 
          }]}; 

          var PlaceRanges2 = {rendererInfos: [{
            "renderer": Dots23,
            "minZoom": 9,
            "maxZoom": 10  
          }]}; 

          var TractRanges2 = {rendererInfos: [{
            "renderer": Dots24,
            "minZoom": 11,
            "maxZoom": 12  
          }, {
            "renderer": Dots25,
            "minZoom": 13,
            "maxZoom": 19
          }]}; 

          var CountyRanges3 = {rendererInfos: [{ 
            "renderer": Dots31,
            "minZoom": 6,
            "maxZoom": 8
          }, {
            "renderer": Dots32,
            "minZoom": 2,  
            "maxZoom": 5 
          }]}; 

          var PlaceRanges3 = {rendererInfos: [{
            "renderer": Dots33,
            "minZoom": 9,
            "maxZoom": 10  
          }]};

          var TractRanges3 = {rendererInfos: [{
            "renderer": Dots34,
            "minZoom": 11,
            "maxZoom": 12  
          }, {
            "renderer": Dots35,
            "minZoom": 13,
            "maxZoom": 19
          }]}; 

          // Define the map variable and setup the div to bind it to

          var map = new Map("viewDiv", {
            basemap: "gray",  
            center: [-95.5, 38], 
            zoom: 5,
            infoWindow: popup            
          }); 

          var scalebar = new Scalebar({
          	map: map,
          	scalebarunit: "dual"
          });

          var geocoder = new Geocoder({
            arcgisGeocoder: {
              placeholder: "Find an address or place"
            },
            autoComplete: true,
            map: map, 
            zoomScale: 10
          }, dom.byId("search"));

          // Setup the function to enable the geocoder functionalty
        
          function showLocation(evt) {
            map.graphics.clear();
            var point = evt.result.feature.geometry;
            var symbol = new SimpleMarkerSymbol()
                .setStyle(SimpleMarkerSymbol.STYLE_CIRCLE)
                .setColor(new Color ([255, 255, 0]))
                .setSize(10);
            var GeocoderPoint =  new Graphic(point, symbol);                
            map.graphics.add(GeocoderPoint); 
            map.infoWindow.setContent(evt.result.name);
            map.infoWindow.show(evt.result.feature.geometry); 
            map.on("click", removePoint);

            function removePoint() {
              map.graphics.remove(GeocoderPoint);
            } 
          }
          
          var CountyScaleRenderer0 = new ScaleDependentRenderer(CountyRanges0, 
            {
            rangeType: "zoom",            
          });

          var PlaceScaleRenderer0 = new ScaleDependentRenderer(PlaceRanges0,
            {
            rangeType: "zoom",  
          });

          var TractScaleRenderer0 = new ScaleDependentRenderer(TractRanges0,
            {
            rangeType: "zoom",  
          }); 
          
          var CountyScaleRenderer1 = new ScaleDependentRenderer(CountyRanges1, 
            {
            rangeType: "zoom",            
          });

          var PlaceScaleRenderer1 = new ScaleDependentRenderer(PlaceRanges1,
            {
            rangeType: "zoom",  
          });

          var TractScaleRenderer1 = new ScaleDependentRenderer(TractRanges1,
            {
            rangeType: "zoom",  
          }); 

          var CountyScaleRenderer2 = new ScaleDependentRenderer(CountyRanges2, 
            {
          rangeType: "zoom",            
          });

          var PlaceScaleRenderer2 = new ScaleDependentRenderer(PlaceRanges2,
            {
            rangeType: "zoom",  
          });

          var TractScaleRenderer2 = new ScaleDependentRenderer(TractRanges2,
            {
            rangeType: "zoom",  
          }); 

          var CountyScaleRenderer3 = new ScaleDependentRenderer(CountyRanges3, 
            {
            rangeType: "zoom",            
          });

          var PlaceScaleRenderer3 = new ScaleDependentRenderer(PlaceRanges3,
            {
            rangeType: "zoom",  
          });

          var TractScaleRenderer3 = new ScaleDependentRenderer(TractRanges3,
            {
            rangeType: "zoom",  
          }); 

          // Create the legend
                   
          var legend = new Legend({
            map: map,
            layerInfos: [{              
              layer: CountyLayer,
              title: "1 bedroom apartments by monthly rent price range as of 2013 mapped by County, Parish and Borough"
            }, {
              layer: PlaceLayer,
              title: "1 bedroom apartments by monthly rent price range as of 2013 mapped by City and Census Designated Place"
            }, {
              layer: TractLayer,
                title: "1 bedroom apartments by monthly rent price range as of 2013 mapped by Census Tract"
            }]            
          }, "legendDiv"); 
          
          CountyLayer.setRenderer(CountyScaleRenderer1);
          PlaceLayer.setRenderer(PlaceScaleRenderer1);
          TractLayer.setRenderer(TractScaleRenderer1);

          map.addLayer(CountyLayer);
          map.addLayer(PlaceLayer);
          map.addLayer(TractLayer);
          map.infoWindow.set("popupWindow", false);
          legend.startup();          
          geocoder.on("select", showLocation);

          var MenuSelect = dom.byId("menu");

          // Setup the function to change which type of apartments, in terms of bedroom numbers, for which the data is displayed 
          // When the dropdown menu option to change it is selected

          function rerender(){
            if(MenuSelect.value === "zero"){
              CountyLayer.setRenderer(CountyScaleRenderer0);
              PlaceLayer.setRenderer(PlaceScaleRenderer0);
              TractLayer.setRenderer(TractScaleRenderer0);
              CountyLayer.infoTemplate = CountyPopupTemplate0;
              PlaceLayer.infoTemplate = PlacePopupTemplate0;
              TractLayer.infoTemplate = TractPopupTemplate0;
              CountyLayer.redraw();
              PlaceLayer.redraw();
              TractLayer.redraw();

              legend.refresh([{
                layer: CountyLayer,
                title: "0 bedroom apartments by monthly rent price range as of 2013 mapped by County, Parish and Borough"
              }, {
                layer: PlaceLayer,
                title: "0 bedroom apartments by monthly rent price range as of 2013 mapped by City and Census Designated Place"
              }, {
                layer: TractLayer,
                title: "0 bedroom apartments by monthly rent price range as of 2013 mapped by Census Tract"
              }]);
            } else if (MenuSelect.value === "one"){
              CountyLayer.setRenderer(CountyScaleRenderer1);
              PlaceLayer.setRenderer(PlaceScaleRenderer1);
              TractLayer.setRenderer(TractScaleRenderer1);
              CountyLayer.infoTemplate = CountyPopupTemplate1;
              PlaceLayer.infoTemplate = PlacePopupTemplate1;
              TractLayer.infoTemplate = TractPopupTemplate1;        
              CountyLayer.redraw();
              PlaceLayer.redraw();
              TractLayer.redraw();

              legend.refresh([{
                layer: CountyLayer,
                title: "1 bedroom apartments by monthly rent price range as of 2013 mapped by County, Parish and Borough"
              }, {
                layer: PlaceLayer,
                title: "1 bedroom apartments by monthly rent price range as of 2013 mapped by City and Census Designated Place"
              }, {
                layer: TractLayer,
                title: "1 bedroom apartments by monthly rent price range as of 2013 mapped by Census Tract"
              }]);              
            } else if (MenuSelect.value === "two"){
              CountyLayer.setRenderer(CountyScaleRenderer2);
              PlaceLayer.setRenderer(PlaceScaleRenderer2);
              TractLayer.setRenderer(TractScaleRenderer2);
              CountyLayer.infoTemplate = CountyPopupTemplate2;
              PlaceLayer.infoTemplate = PlacePopupTemplate2;
              TractLayer.infoTemplate = TractPopupTemplate2;
              CountyLayer.redraw();
              PlaceLayer.redraw();
              TractLayer.redraw();
            
              legend.refresh([{
                layer: CountyLayer,
                title: "2 bedroom apartments by monthly rent price range as of 2013 mapped by County, Parish and Borough"
              }, {
                layer: PlaceLayer,
                title: "2 bedroom apartments by monthly rent price range as of 2013 mapped by City and Census Designated Place"
              }, {
                layer: TractLayer,
                title: "2 bedroom apartments by monthly rent price range as of 2013 mapped by Census Tract"
              }]);
            } else if (MenuSelect.value === "threeplus"){
              CountyLayer.setRenderer(CountyScaleRenderer3);
              PlaceLayer.setRenderer(PlaceScaleRenderer3);
              TractLayer.setRenderer(TractScaleRenderer3);
              CountyLayer.infoTemplate = CountyPopupTemplate3;
              PlaceLayer.infoTemplate = PlacePopupTemplate3;
              TractLayer.infoTemplate = TractPopupTemplate3;
              CountyLayer.redraw();
              PlaceLayer.redraw();
              TractLayer.redraw();

              legend.refresh([{
                layer: CountyLayer,
                title: "3+ bedroom apartments by monthly rent price range as of 2013 mapped by County, Parish and Borough"
              }, {
                layer: PlaceLayer,
                title: "3+ bedroom apartments by monthly rent price range as of 2013 mapped by City and Census Designated Place"
              }, {
                layer: TractLayer,
                title: "3+ bedroom apartments by monthly rent price range as of 2013 mapped by Census Tract"
              }]);
            }
          }

          on(MenuSelect, "change", rerender);

          // Setup the popup which is displayed when one of the Counties, Cities, or Tracts is selected

          ready(function(){
          
            parser.parse();

            myContentPane = registry.byId("popupDiv");

            function displayPopupContent(feature) {
              if (feature) {
                var info = feature.getContent();                
                myContentPane.set("content", info);
                document.getElementById("sidebar2").style.visibility = 'visible'
              } 
            }

            var infowin = map.infoWindow;
            connect.connect(infowin, "onSelectionChange", function () {
              displayPopupContent(infowin.getSelectedFeature());
            });

            connect.connect(infowin, "onClearFeatures", function() {
              myContentPane.set("content", "");
              document.getElementById("sidebar2").style.visibility = 'hidden'
            });
                      
          });
                                                         
      });         
            
    </script>
  </head>

  <body class="claro">
    <div id="search"></div>
    <div id="viewDiv"></div>
    <div id="sidebar1"> 
      <div id="legendDiv"></div>
      <font size="2">Select apartment type</font><br><br>
      <select id="menu">          
        <option value="zero">No Bedroom</option>     
        <option value="one" selected>One Bedroom</option>  
        <option value="two">Two Bedrooms</option> 
        <option value="threeplus">Three or more Bedrooms</option> 
      </select><br><br><br>             
    </div>
    <div id="sidebar2">
       <div id="popupDiv" data-dojo-type="dijit/layout/ContentPane"></div><br>
    </div>
  </body>
</html>